################################################################################
# Hooks System Configuration File
#
# Purpose: Centralized configuration for all hook scripts
# Location: .claude/hooks/config.conf
# Created: 2025-10-30
#
# This file is sourced by common.sh when hooks run.
# You can override any setting via environment variables.
################################################################################

# General Settings
export HOOKS_VERSION="2.0.0"
export HOOKS_VERBOSE="${HOOKS_VERBOSE:-0}"
export HOOKS_QUIET="${HOOKS_QUIET:-0}"
export HOOKS_COLOR="${HOOKS_COLOR:-auto}"
export HOOKS_CONTINUE_ON_ERROR="${HOOKS_CONTINUE_ON_ERROR:-0}"
export HOOKS_JSON_OUTPUT="${HOOKS_JSON_OUTPUT:-0}"

# Timeouts (seconds)
export HOOKS_TIMEOUT="${HOOKS_TIMEOUT:-300}"          # 5 minutes default
export HOOKS_BUILD_TIMEOUT="${HOOKS_BUILD_TIMEOUT:-600}"  # 10 minutes for builds
export HOOKS_TEST_TIMEOUT="${HOOKS_TEST_TIMEOUT:-300}"    # 5 minutes for tests

# Retry Configuration
export HOOKS_RETRY_COUNT="${HOOKS_RETRY_COUNT:-3}"
export HOOKS_RETRY_DELAY="${HOOKS_RETRY_DELAY:-2}"    # Initial delay in seconds

# Memory Thresholds (percent)
export MEMORY_WARNING_THRESHOLD="${MEMORY_WARNING_THRESHOLD:-60}"
export MEMORY_CRITICAL_THRESHOLD="${MEMORY_CRITICAL_THRESHOLD:-75}"

# Chrome Memory Threshold (MB)
export CHROME_MEMORY_THRESHOLD_MB="${CHROME_MEMORY_THRESHOLD_MB:-1024}"

# Documentation Freshness (minutes)
export DOCS_FRESHNESS_THRESHOLD="${DOCS_FRESHNESS_THRESHOLD:-30}"

# Coverage Thresholds (percent)
export BACKEND_COVERAGE_THRESHOLD="${BACKEND_COVERAGE_THRESHOLD:-80}"
export FRONTEND_COVERAGE_THRESHOLD="${FRONTEND_COVERAGE_THRESHOLD:-60}"

# Complexity Thresholds
export MAX_CYCLOMATIC_COMPLEXITY="${MAX_CYCLOMATIC_COMPLEXITY:-10}"
export MAX_COGNITIVE_COMPLEXITY="${MAX_COGNITIVE_COMPLEXITY:-15}"

# File Size Limits (bytes)
export MAX_FILE_SIZE="${MAX_FILE_SIZE:-1048576}"      # 1MB
export MAX_COMMIT_SIZE="${MAX_COMMIT_SIZE:-52428800}"  # 50MB total

# Logging
export HOOKS_LOG_DIR="${HOOKS_LOG_DIR:-/tmp/hooks-logs}"
export HOOKS_LOG_LEVEL="${HOOKS_LOG_LEVEL:-INFO}"     # DEBUG, INFO, WARNING, ERROR

# Parallel Execution
export HOOKS_MAX_PARALLEL="${HOOKS_MAX_PARALLEL:-4}"
export HOOKS_PARALLEL_DEFAULT="${HOOKS_PARALLEL_DEFAULT:-0}"

# Auto-Fix Settings
export HOOKS_AUTO_FIX="${HOOKS_AUTO_FIX:-0}"
export HOOKS_AUTO_FIX_LINT="${HOOKS_AUTO_FIX_LINT:-1}"
export HOOKS_AUTO_FIX_FORMAT="${HOOKS_AUTO_FIX_FORMAT:-1}"
export HOOKS_AUTO_FIX_IMPORTS="${HOOKS_AUTO_FIX_IMPORTS:-1}"

# Security Scanning
export ENABLE_SECURITY_SCAN="${ENABLE_SECURITY_SCAN:-0}"
export SECURITY_SEVERITY_THRESHOLD="${SECURITY_SEVERITY_THRESHOLD:-MEDIUM}"

# Skip Flags (for CI/CD)
export SKIP_INTERACTIVE="${SKIP_INTERACTIVE:-0}"
export SKIP_SLOW_CHECKS="${SKIP_SLOW_CHECKS:-0}"
export SKIP_OPTIONAL_CHECKS="${SKIP_OPTIONAL_CHECKS:-0}"

# Tool Paths (override if not in PATH)
export PYTHON_BIN="${PYTHON_BIN:-python3}"
export NPM_BIN="${NPM_BIN:-npm}"
export GIT_BIN="${GIT_BIN:-git}"
export PYTEST_BIN="${PYTEST_BIN:-pytest}"

# Project Paths (PROJECT_ROOT should be set by the calling script)
# Fallback uses the config file location to determine project root
export PROJECT_ROOT="${PROJECT_ROOT:-$(cd "$(dirname "${BASH_SOURCE[0]}")/../.." && pwd)}"
export BACKEND_DIR="${BACKEND_DIR:-$PROJECT_ROOT/backend}"
export FRONTEND_DIR="${FRONTEND_DIR:-$PROJECT_ROOT/frontend}"
export DOCS_DIR="${DOCS_DIR:-$PROJECT_ROOT/.claude}"

# Virtual Environment
export VENV_PATH="${VENV_PATH:-$BACKEND_DIR/venv}"
export AUTO_ACTIVATE_VENV="${AUTO_ACTIVATE_VENV:-1}"

# Notification Settings (future feature)
export NOTIFY_ON_SUCCESS="${NOTIFY_ON_SUCCESS:-0}"
export NOTIFY_ON_FAILURE="${NOTIFY_ON_FAILURE:-1}"
export NOTIFY_METHOD="${NOTIFY_METHOD:-console}"  # console, desktop, slack

# CI/CD Detection
if [ -n "$CI" ] || [ -n "$GITHUB_ACTIONS" ] || [ -n "$JENKINS_HOME" ]; then
  export IN_CI_ENVIRONMENT=1
  export HOOKS_COLOR="never"
  export SKIP_INTERACTIVE=1
else
  export IN_CI_ENVIRONMENT=0
fi

# WSL2 Specific Settings
if grep -qi microsoft /proc/version 2>/dev/null; then
  export IN_WSL2=1
  export DISPLAY="${DISPLAY:-:0}"
  export CHROME_USER_DATA_DIR="${CHROME_USER_DATA_DIR:-/tmp/chrome-wsl-profile}"
else
  export IN_WSL2=0
fi

# Hook-Specific Settings

# backend-syntax-check.sh
export BACKEND_CHECK_IMPORTS="${BACKEND_CHECK_IMPORTS:-1}"
export BACKEND_CHECK_TYPES="${BACKEND_CHECK_TYPES:-0}"
export BACKEND_CHECK_SECURITY="${BACKEND_CHECK_SECURITY:-0}"
export BACKEND_CHECK_COMPLEXITY="${BACKEND_CHECK_COMPLEXITY:-0}"

# post-feature.sh
export POST_FEATURE_RUN_TESTS="${POST_FEATURE_RUN_TESTS:-1}"
export POST_FEATURE_CHECK_COVERAGE="${POST_FEATURE_CHECK_COVERAGE:-0}"
export POST_FEATURE_CHECK_DOCS="${POST_FEATURE_CHECK_DOCS:-1}"
export POST_FEATURE_CHECK_LINT="${POST_FEATURE_CHECK_LINT:-1}"

# verify-build.sh
export VERIFY_BUILD_FRONTEND="${VERIFY_BUILD_FRONTEND:-1}"
export VERIFY_BUILD_BACKEND="${VERIFY_BUILD_BACKEND:-1}"
export VERIFY_BUILD_FAIL_ON_WARNING="${VERIFY_BUILD_FAIL_ON_WARNING:-0}"

# Custom User Overrides
# Create ~/.claude-hooks.conf for personal preferences
if [ -f "$HOME/.claude-hooks.conf" ]; then
  source "$HOME/.claude-hooks.conf"
fi

# Project-Specific Overrides
# Create .claude-hooks.local.conf in project root (git-ignored)
if [ -f "$PROJECT_ROOT/.claude-hooks.local.conf" ]; then
  source "$PROJECT_ROOT/.claude-hooks.local.conf"
fi